/**
 * jquery.Jcrop.js v0.9.12
 * jQuery Image Cropping Plugin - released under MIT License 
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */
!function(t){t.Jcrop=function(e,i){function n(t){return Math.round(t)+"px"}function o(t){return A.baseClass+"-"+t}function s(){return t.fx.step.hasOwnProperty("backgroundColor")}function r(e){var i=t(e).offset();return[i.left,i.top]}function a(t){return[t.pageX-I[0],t.pageY-I[1]]}function l(e){"object"!=typeof e&&(e={}),A=t.extend(A,e),t.each(["onChange","onSelect","onRelease","onDblClick"],function(t,e){"function"!=typeof A[e]&&(A[e]=function(){})})}function h(t,e,i){if(I=r(W),ft.setCursor("move"===t?t:t+"-resize"),"move"===t)return ft.activateHandlers(c(e),g,i);var n=ct.getFixed(),o=d(t),s=ct.getCorner(d(o));ct.setPressed(ct.getCorner(o)),ct.setCurrent(s),ft.activateHandlers(u(t,n),g,i)}function u(t,e){return function(i){if(A.aspectRatio)switch(t){case"e":i[1]=e.y+1;break;case"w":i[1]=e.y+1;break;case"n":i[0]=e.x+1;break;case"s":i[0]=e.x+1}else switch(t){case"e":i[1]=e.y2;break;case"w":i[1]=e.y2;break;case"n":i[0]=e.x2;break;case"s":i[0]=e.x2}ct.setCurrent(i),pt.update()}}function c(t){var e=t;return mt.watchKeys(),function(t){ct.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,pt.update()}}function d(t){switch(t){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function p(t){return function(e){return A.disabled?!1:"move"!==t||A.allowMove?(I=r(W),nt=!0,h(t,a(e)),e.stopPropagation(),e.preventDefault(),!1):!1}}function f(t,e,i){var n=t.width(),o=t.height();n>e&&e>0&&(n=e,o=e/t.width()*t.height()),o>i&&i>0&&(o=i,n=i/t.height()*t.width()),et=t.width()/n,it=t.height()/o,t.width(n).height(o)}function m(t){return{x:t.x*et,y:t.y*it,x2:t.x2*et,y2:t.y2*it,w:t.w*et,h:t.h*it}}function g(){var t=ct.getFixed();t.w>A.minSelect[0]&&t.h>A.minSelect[1]?(pt.enableHandles(),pt.done()):pt.release(),ft.setCursor(A.allowSelect?"crosshair":"default")}function v(t){if(A.disabled)return!1;if(!A.allowSelect)return!1;nt=!0,I=r(W),pt.disableHandles(),ft.setCursor("crosshair");var e=a(t);return ct.setPressed(e),pt.update(),ft.activateHandlers(_,g,"touch"===t.type.substring(0,5)),mt.watchKeys(),t.stopPropagation(),t.preventDefault(),!1}function _(t){ct.setCurrent(t),pt.update()}function y(){var e=t("<div></div>").addClass(o("tracker"));return j&&e.css({opacity:0,backgroundColor:"white"}),e}function b(t){G.removeClass().addClass(o("holder")).addClass(t)}function w(t,e){function i(){window.setTimeout(_,c)}var n=t[0]/et,o=t[1]/it,s=t[2]/et,r=t[3]/it;if(!ot){var a=ct.flipCoords(n,o,s,r),l=ct.getFixed(),h=[l.x,l.y,l.x2,l.y2],u=h,c=A.animationDelay,d=a[0]-h[0],p=a[1]-h[1],f=a[2]-h[2],m=a[3]-h[3],g=0,v=A.swingSpeed;n=u[0],o=u[1],s=u[2],r=u[3],pt.animMode(!0);var _=function(){return function(){g+=(100-g)/v,u[0]=Math.round(n+g/100*d),u[1]=Math.round(o+g/100*p),u[2]=Math.round(s+g/100*f),u[3]=Math.round(r+g/100*m),g>=99.8&&(g=100),100>g?(k(u),i()):(pt.done(),pt.animMode(!1),"function"==typeof e&&e.call(gt))}}();i()}}function D(t){k([t[0]/et,t[1]/it,t[2]/et,t[3]/it]),A.onSelect.call(gt,m(ct.getFixed())),pt.enableHandles()}function k(t){ct.setPressed([t[0],t[1]]),ct.setCurrent([t[2],t[3]]),pt.update()}function C(){return m(ct.getFixed())}function x(){return ct.getFixed()}function E(t){l(t),L()}function T(){A.disabled=!0,pt.disableHandles(),pt.setCursor("default"),ft.setCursor("default")}function M(){A.disabled=!1,L()}function S(){pt.done(),ft.activateHandlers(null,null)}function P(){G.remove(),B.show(),B.css("visibility","visible"),t(e).removeData("Jcrop")}function N(t,e){pt.release(),T();var i=new Image;i.onload=function(){var n=i.width,o=i.height,s=A.boxWidth,r=A.boxHeight;W.width(n).height(o),W.attr("src",t),J.attr("src",t),f(W,s,r),V=W.width(),q=W.height(),J.width(V).height(q),at.width(V+2*rt).height(q+2*rt),G.width(V).height(q),dt.resize(V,q),M(),"function"==typeof e&&e.call(gt)},i.src=t}function O(t,e,i){var n=e||A.bgColor;A.bgFade&&s()&&A.fadeTime&&!i?t.animate({backgroundColor:n},{queue:!1,duration:A.fadeTime}):t.css("backgroundColor",n)}function L(t){A.allowResize?t?pt.enableOnly():pt.enableHandles():pt.disableHandles(),ft.setCursor(A.allowSelect?"crosshair":"default"),pt.setCursor(A.allowMove?"move":"default"),A.hasOwnProperty("trueSize")&&(et=A.trueSize[0]/V,it=A.trueSize[1]/q),A.hasOwnProperty("setSelect")&&(D(A.setSelect),pt.done(),delete A.setSelect),dt.refresh(),A.bgColor!=lt&&(O(A.shade?dt.getShades():G,A.shade?A.shadeColor||A.bgColor:A.bgColor),lt=A.bgColor),ht!=A.bgOpacity&&(ht=A.bgOpacity,A.shade?dt.refresh():pt.setBgOpacity(ht)),$=A.maxSize[0]||0,Q=A.maxSize[1]||0,X=A.minSize[0]||0,tt=A.minSize[1]||0,A.hasOwnProperty("outerImage")&&(W.attr("src",A.outerImage),delete A.outerImage),pt.refresh()}var I,A=t.extend({},t.Jcrop.defaults),R=navigator.userAgent.toLowerCase(),j=/msie/.test(R),z=/msie [1-6]\./.test(R);"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof i&&(i={}),l(i);var U={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},B=t(e),F=!0;if("IMG"==e.tagName){if(0!=B[0].width&&0!=B[0].height)B.width(B[0].width),B.height(B[0].height);else{var H=new Image;H.src=B[0].src,B.width(H.width),B.height(H.height)}var W=B.clone().removeAttr("id").css(U).show();W.width(B.width()),W.height(B.height()),B.after(W).hide()}else W=B.css(U).show(),F=!1,null===A.shade&&(A.shade=!0);f(W,A.boxWidth,A.boxHeight);var V=W.width(),q=W.height(),G=t("<div />").width(V).height(q).addClass(o("holder")).css({position:"relative",backgroundColor:A.bgColor}).insertAfter(B).append(W);A.addClass&&G.addClass(A.addClass);var J=t("<div />"),Y=t("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Z=t("<div />").width("100%").height("100%").css("zIndex",320),K=t("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var t=ct.getFixed();A.onDblClick.call(gt,t)}).insertBefore(W).append(Y,Z);F&&(J=t("<img />").attr("src",W.attr("src")).css(U).width(V).height(q),Y.append(J)),z&&K.css({overflowY:"hidden"});var $,Q,X,tt,et,it,nt,ot,st,rt=A.boundary,at=y().width(V+2*rt).height(q+2*rt).css({position:"absolute",top:n(-rt),left:n(-rt),zIndex:290}).mousedown(v),lt=A.bgColor,ht=A.bgOpacity;I=r(W);var ut=function(){function t(){var t,e={},i=["touchstart","touchmove","touchend"],n=document.createElement("div");try{for(t=0;t<i.length;t++){var o=i[t];o="on"+o;var s=o in n;s||(n.setAttribute(o,"return;"),s="function"==typeof n[o]),e[i[t]]=s}return e.touchstart&&e.touchend&&e.touchmove}catch(r){return!1}}function e(){return A.touchSupport===!0||A.touchSupport===!1?A.touchSupport:t()}return{createDragger:function(t){return function(e){return A.disabled?!1:"move"!==t||A.allowMove?(I=r(W),nt=!0,h(t,a(ut.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(t){return v(ut.cfilter(t))},cfilter:function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t},isSupported:t,support:e()}}(),ct=function(){function t(t){t=r(t),f=d=t[0],m=p=t[1]}function e(t){t=r(t),u=t[0]-f,c=t[1]-m,f=t[0],m=t[1]}function i(){return[u,c]}function n(t){var e=t[0],i=t[1];0>d+e&&(e-=e+d),0>p+i&&(i-=i+p),m+i>q&&(i+=q-(m+i)),f+e>V&&(e+=V-(f+e)),d+=e,f+=e,p+=i,m+=i}function o(t){var e=s();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function s(){if(!A.aspectRatio)return l();var t,e,i,n,o=A.aspectRatio,s=A.minSize[0]/et,r=A.maxSize[0]/et,u=A.maxSize[1]/it,c=f-d,g=m-p,v=Math.abs(c),_=Math.abs(g),y=v/_;return 0===r&&(r=10*V),0===u&&(u=10*q),o>y?(e=m,i=_*o,t=0>c?d-i:i+d,0>t?(t=0,n=Math.abs((t-d)/o),e=0>g?p-n:n+p):t>V&&(t=V,n=Math.abs((t-d)/o),e=0>g?p-n:n+p)):(t=f,n=v/o,e=0>g?p-n:p+n,0>e?(e=0,i=Math.abs((e-p)*o),t=0>c?d-i:i+d):e>q&&(e=q,i=Math.abs(e-p)*o,t=0>c?d-i:i+d)),t>d?(s>t-d?t=d+s:t-d>r&&(t=d+r),e=e>p?p+(t-d)/o:p-(t-d)/o):d>t&&(s>d-t?t=d-s:d-t>r&&(t=d-r),e=e>p?p+(d-t)/o:p-(d-t)/o),0>t?(d-=t,t=0):t>V&&(d-=t-V,t=V),0>e?(p-=e,e=0):e>q&&(p-=e-q,e=q),h(a(d,p,t,e))}function r(t){return t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t[0]>V&&(t[0]=V),t[1]>q&&(t[1]=q),[Math.round(t[0]),Math.round(t[1])]}function a(t,e,i,n){var o=t,s=i,r=e,a=n;return t>i&&(o=i,s=t),e>n&&(r=n,a=e),[o,r,s,a]}function l(){var t,e=f-d,i=m-p;return $&&Math.abs(e)>$&&(f=e>0?d+$:d-$),Q&&Math.abs(i)>Q&&(m=i>0?p+Q:p-Q),tt/it&&Math.abs(i)<tt/it&&(m=i>0?p+tt/it:p-tt/it),X/et&&Math.abs(e)<X/et&&(f=e>0?d+X/et:d-X/et),0>d&&(f-=d,d-=d),0>p&&(m-=p,p-=p),0>f&&(d-=f,f-=f),0>m&&(p-=m,m-=m),f>V&&(t=f-V,d-=t,f-=t),m>q&&(t=m-q,p-=t,m-=t),d>V&&(t=d-q,m-=t,p-=t),p>q&&(t=p-q,m-=t,p-=t),h(a(d,p,f,m))}function h(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var u,c,d=0,p=0,f=0,m=0;return{flipCoords:a,setPressed:t,setCurrent:e,getOffset:i,moveOffset:n,getCorner:o,getFixed:s}}(),dt=function(){function e(t,e){f.left.css({height:n(e)}),f.right.css({height:n(e)})}function i(){return o(ct.getFixed())}function o(t){f.top.css({left:n(t.x),width:n(t.w),height:n(t.y)}),f.bottom.css({top:n(t.y2),left:n(t.x),width:n(t.w),height:n(q-t.y2)}),f.right.css({left:n(t.x2),width:n(V-t.x2)}),f.left.css({width:n(t.x)})}function s(){return t("<div />").css({position:"absolute",backgroundColor:A.shadeColor||A.bgColor}).appendTo(p)}function r(){d||(d=!0,p.insertBefore(W),i(),pt.setBgOpacity(1,0,1),J.hide(),a(A.shadeColor||A.bgColor,1),pt.isAwake()?h(A.bgOpacity,1):h(1,1))}function a(t,e){O(c(),t,e)}function l(){d&&(p.remove(),J.show(),d=!1,pt.isAwake()?pt.setBgOpacity(A.bgOpacity,1,1):(pt.setBgOpacity(1,1,1),pt.disableHandles()),O(G,0,1))}function h(t,e){d&&(A.bgFade&&!e?p.animate({opacity:1-t},{queue:!1,duration:A.fadeTime}):p.css({opacity:1-t}))}function u(){A.shade?r():l(),pt.isAwake()&&h(A.bgOpacity)}function c(){return p.children()}var d=!1,p=t("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:s(),left:s().height(q),right:s().height(q),bottom:s()};return{update:i,updateRaw:o,getShades:c,setBgColor:a,enable:r,disable:l,resize:e,refresh:u,opacity:h}}(),pt=function(){function e(e){var i=t("<div />").css({position:"absolute",opacity:A.borderOpacity}).addClass(o(e));return Y.append(i),i}function i(e,i){var n=t("<div />").mousedown(p(e)).css({cursor:e+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+e);return ut.support&&n.bind("touchstart.jcrop",ut.createDragger(e)),Z.append(n),n}function s(t){var e=A.handleSize,n=i(t,T++).css({opacity:A.handleOpacity}).addClass(o("handle"));return e&&n.width(e).height(e),n}function r(t){return i(t,T++).addClass("jcrop-dragbar")}function a(t){var e;for(e=0;e<t.length;e++)P[t[e]]=r(t[e])}function l(t){var i,n;for(n=0;n<t.length;n++){switch(t[n]){case"n":i="hline";break;case"s":i="hline bottom";break;case"e":i="vline right";break;case"w":i="vline"}M[t[n]]=e(i)}}function h(t){var e;for(e=0;e<t.length;e++)S[t[e]]=s(t[e])}function u(t,e){A.shade||J.css({top:n(-e),left:n(-t)}),K.css({top:n(e),left:n(t)})}function c(t,e){K.width(Math.round(t)).height(Math.round(e))}function d(){var t=ct.getFixed();ct.setPressed([t.x,t.y]),ct.setCurrent([t.x2,t.y2]),f()}function f(t){return E?g(t):void 0}function g(t){var e=ct.getFixed();c(e.w,e.h),u(e.x,e.y),A.shade&&dt.updateRaw(e),E||_(),t?A.onSelect.call(gt,m(e)):A.onChange.call(gt,m(e))}function v(t,e,i){(E||e)&&(A.bgFade&&!i?W.animate({opacity:t},{queue:!1,duration:A.fadeTime}):W.css("opacity",t))}function _(){K.show(),A.shade?dt.opacity(ht):v(ht,!0),E=!0}function b(){k(),K.hide(),A.shade?dt.opacity(1):v(1),E=!1,A.onRelease.call(gt)}function w(){N&&Z.show()}function D(){return N=!0,A.allowResize?(Z.show(),!0):void 0}function k(){N=!1,Z.hide()}function C(t){t?(ot=!0,k()):(ot=!1,D())}function x(){C(!1),d()}var E,T=370,M={},S={},P={},N=!1;A.dragEdges&&t.isArray(A.createDragbars)&&a(A.createDragbars),t.isArray(A.createHandles)&&h(A.createHandles),A.drawBorders&&t.isArray(A.createBorders)&&l(A.createBorders),t(document).bind("touchstart.jcrop-ios",function(e){t(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var O=y().mousedown(p("move")).css({cursor:"move",position:"absolute",zIndex:360});return ut.support&&O.bind("touchstart.jcrop",ut.createDragger("move")),Y.append(O),k(),{updateVisible:f,update:g,release:b,refresh:d,isAwake:function(){return E},setCursor:function(t){O.css("cursor",t)},enableHandles:D,enableOnly:function(){N=!0},showHandles:w,disableHandles:k,animMode:C,setBgOpacity:v,done:x}}(),ft=function(){function e(e){at.css({zIndex:450}),e?t(document).bind("touchmove.jcrop",r).bind("touchend.jcrop",l):d&&t(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",o)}function i(){at.css({zIndex:290}),t(document).unbind(".jcrop")}function n(t){return u(a(t)),!1}function o(t){return t.preventDefault(),t.stopPropagation(),nt&&(nt=!1,c(a(t)),pt.isAwake()&&A.onSelect.call(gt,m(ct.getFixed())),i(),u=function(){},c=function(){}),!1}function s(t,i,n){return nt=!0,u=t,c=i,e(n),!1}function r(t){return u(a(ut.cfilter(t))),!1}function l(t){return o(ut.cfilter(t))}function h(t){at.css("cursor",t)}var u=function(){},c=function(){},d=A.trackDocument;return d||at.mousemove(n).mouseup(o).mouseout(o),W.before(at),{activateHandlers:s,setCursor:h}}(),mt=function(){function e(){A.keySupport&&(s.show(),s.focus())}function i(){s.hide()}function n(t,e,i){A.allowMove&&(ct.moveOffset([e,i]),pt.updateVisible(!0)),t.preventDefault(),t.stopPropagation()}function o(t){if(t.ctrlKey||t.metaKey)return!0;st=!!t.shiftKey;var e=st?10:1;switch(t.keyCode){case 37:n(t,-e,0);break;case 39:n(t,e,0);break;case 38:n(t,0,-e);break;case 40:n(t,0,e);break;case 27:A.allowSelect&&pt.release();break;case 9:return!0}return!1}var s=t('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),r=t("<div />").css({position:"absolute",overflow:"hidden"}).append(s);return A.keySupport&&(s.keydown(o).blur(i),z||!A.fixedSupport?(s.css({position:"absolute",left:"-20px"}),r.append(s).insertBefore(W)):s.insertBefore(W)),{watchKeys:e}}();ut.support&&at.bind("touchstart.jcrop",ut.newSelection),Z.hide(),L(!0);var gt={setImage:N,animateTo:w,setSelect:D,setOptions:E,tellSelect:C,tellScaled:x,setClass:b,disable:T,enable:M,cancel:S,release:pt.release,destroy:P,focus:mt.watchKeys,getBounds:function(){return[V*et,q*it]},getWidgetSize:function(){return[V,q]},getScaleFactor:function(){return[et,it]},getOptions:function(){return A},ui:{holder:G,selection:K}};return j&&G.bind("selectstart",function(){return!1}),B.data("Jcrop",gt),gt},t.fn.Jcrop=function(e,i){var n;return this.each(function(){if(t(this).data("Jcrop")){if("api"===e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?t.Jcrop.Loader(this,function(){t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n)}):(t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n))}),this},t.Jcrop.Loader=function(e,i,n){function o(){r.complete?(s.unbind(".jcloader"),t.isFunction(i)&&i.call(r)):window.setTimeout(o,50)}var s=t(e),r=s[0];s.bind("load.jcloader",o).bind("error.jcloader",function(){s.unbind(".jcloader"),t.isFunction(n)&&n.call(r)}),r.complete&&t.isFunction(i)&&(s.unbind(".jcloader"),i.call(r))},t.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);