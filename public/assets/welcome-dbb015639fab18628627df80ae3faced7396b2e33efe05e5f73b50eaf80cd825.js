$(function(){function t(t){for(var e=h.getElementsByTagName("div"),i=0;i<e.length;i++)e[i].className=e[i].className.replace(/active/,"").replace(/\s\s*$/,"");t.className+=" active"}function e(){c.eachLayer(function(e){var i=e.feature.properties,s=h.appendChild(document.createElement("div"));s.className="item";var n=s.appendChild(document.createElement("a"));n.href="#",n.title="Click to see this anthropologist!",n.className="title",n.id="person",n.innerHTML=i.name;var a=s.appendChild(document.createElement("div"));a.className="personTitle",a.innerHTML=i.researcher;var r=s.appendChild(document.createElement("div"));r.innerHTML=i.location,n.onclick=function(){return t(s),o.setView(e.getLatLng(),16),e.openPopup(),!1},e.on("click",function(){o.panTo(e.getLatLng()),t(s)})})}L.mapbox.accessToken="pk.eyJ1IjoiYW1waGl0aGVyZSIsImEiOiIyZGE2MWJhYTdlNjJkM2E4NTZhYjUyODE3NDFmNzY3MSJ9.EDkcexR3h8zGfuPOXADctQ";var i=L.latLng(-180,-180),s=L.latLng(180,180),n=L.latLngBounds(i,s),o=L.mapbox.map("map","amphithere.nanckefd",{maxBounds:n,maxZoom:20,minZoom:2,tileLayer:{continuousWorld:!1,noWrap:!0}}).addControl(L.mapbox.geocoderControl("mapbox.places",{autocomplete:!0})),a=document.getElementById("filter-donor"),r=document.getElementById("filter-all"),l=document.getElementById("backToSize");o.fitBounds(n),l.onclick=function(){return o.setView([25,5],2),!1},a.onclick=function(){return r.className="",this.className="active",h.innerHTML="",c.setFilter(function(t){return t.properties.available===!0}),e(),!1},r.onclick=function(){return a.className="",this.className="active",h.innerHTML="",c.setFilter(function(){return!0}),e(),!1},o.scrollWheelZoom.disable();var h=document.getElementById("listings"),c=L.mapbox.featureLayer().addTo(o);c.loadURL("welcome/map.json"),c.on("ready",function(){e()}),c.on("layeradd",function(t){var e=t.layer,i=(e.feature,e.feature.properties),s='<div class="popup"><h3>'+i.name+"</h3><b>"+i.researcher+'</b><p><div class = "line-clamp">'+i.bio+"</div></p><a href= /researches/"+i.id+">Read more...</a>";s+="</div>",e.bindPopup(s,{minWidth:320})})}),$(function(){$("#backToSize").tooltip()}),$(function(){return $("form").on("click",".remove_fields",function(t){return $(this).closest(".field").remove(),t.preventDefault()}),$("form").on("click",".add_fields",function(t){var e,i;return i=(new Date).getTime(),e=new RegExp($(this).data("id"),"g"),$(this).before($(this).data("fields").replace(e,i)),t.preventDefault()})});