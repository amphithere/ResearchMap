/**
 * jquery.Jcrop.js v0.9.12
 * jQuery Image Cropping Plugin - released under MIT License 
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */
!function(t){t.Jcrop=function(e,i){function n(t){return Math.round(t)+"px"}function s(t){return R.baseClass+"-"+t}function o(){return t.fx.step.hasOwnProperty("backgroundColor")}function a(e){var i=t(e).offset();return[i.left,i.top]}function r(t){return[t.pageX-A[0],t.pageY-A[1]]}function l(e){"object"!=typeof e&&(e={}),R=t.extend(R,e),t.each(["onChange","onSelect","onRelease","onDblClick"],function(t,e){"function"!=typeof R[e]&&(R[e]=function(){})})}function h(t,e,i){if(A=a(V),ft.setCursor("move"===t?t:t+"-resize"),"move"===t)return ft.activateHandlers(c(e),g,i);var n=ct.getFixed(),s=d(t),o=ct.getCorner(d(s));ct.setPressed(ct.getCorner(s)),ct.setCurrent(o),ft.activateHandlers(u(t,n),g,i)}function u(t,e){return function(i){if(R.aspectRatio)switch(t){case"e":i[1]=e.y+1;break;case"w":i[1]=e.y+1;break;case"n":i[0]=e.x+1;break;case"s":i[0]=e.x+1}else switch(t){case"e":i[1]=e.y2;break;case"w":i[1]=e.y2;break;case"n":i[0]=e.x2;break;case"s":i[0]=e.x2}ct.setCurrent(i),pt.update()}}function c(t){var e=t;return mt.watchKeys(),function(t){ct.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,pt.update()}}function d(t){switch(t){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function p(t){return function(e){return R.disabled?!1:"move"!==t||R.allowMove?(A=a(V),nt=!0,h(t,r(e)),e.stopPropagation(),e.preventDefault(),!1):!1}}function f(t,e,i){var n=t.width(),s=t.height();n>e&&e>0&&(n=e,s=e/t.width()*t.height()),s>i&&i>0&&(s=i,n=i/t.height()*t.width()),et=t.width()/n,it=t.height()/s,t.width(n).height(s)}function m(t){return{x:t.x*et,y:t.y*it,x2:t.x2*et,y2:t.y2*it,w:t.w*et,h:t.h*it}}function g(){var t=ct.getFixed();t.w>R.minSelect[0]&&t.h>R.minSelect[1]?(pt.enableHandles(),pt.done()):pt.release(),ft.setCursor(R.allowSelect?"crosshair":"default")}function v(t){if(R.disabled)return!1;if(!R.allowSelect)return!1;nt=!0,A=a(V),pt.disableHandles(),ft.setCursor("crosshair");var e=r(t);return ct.setPressed(e),pt.update(),ft.activateHandlers(y,g,"touch"===t.type.substring(0,5)),mt.watchKeys(),t.stopPropagation(),t.preventDefault(),!1}function y(t){ct.setCurrent(t),pt.update()}function _(){var e=t("<div></div>").addClass(s("tracker"));return z&&e.css({opacity:0,backgroundColor:"white"}),e}function b(t){Y.removeClass().addClass(s("holder")).addClass(t)}function w(t,e){function i(){window.setTimeout(y,c)}var n=t[0]/et,s=t[1]/it,o=t[2]/et,a=t[3]/it;if(!st){var r=ct.flipCoords(n,s,o,a),l=ct.getFixed(),h=[l.x,l.y,l.x2,l.y2],u=h,c=R.animationDelay,d=r[0]-h[0],p=r[1]-h[1],f=r[2]-h[2],m=r[3]-h[3],g=0,v=R.swingSpeed;n=u[0],s=u[1],o=u[2],a=u[3],pt.animMode(!0);var y=function(){return function(){g+=(100-g)/v,u[0]=Math.round(n+g/100*d),u[1]=Math.round(s+g/100*p),u[2]=Math.round(o+g/100*f),u[3]=Math.round(a+g/100*m),g>=99.8&&(g=100),100>g?(D(u),i()):(pt.done(),pt.animMode(!1),"function"==typeof e&&e.call(gt))}}();i()}}function k(t){D([t[0]/et,t[1]/it,t[2]/et,t[3]/it]),R.onSelect.call(gt,m(ct.getFixed())),pt.enableHandles()}function D(t){ct.setPressed([t[0],t[1]]),ct.setCurrent([t[2],t[3]]),pt.update()}function C(){return m(ct.getFixed())}function x(){return ct.getFixed()}function S(t){l(t),P()}function T(){R.disabled=!0,pt.disableHandles(),pt.setCursor("default"),ft.setCursor("default")}function E(){R.disabled=!1,P()}function M(){pt.done(),ft.activateHandlers(null,null)}function N(){Y.remove(),L.show(),L.css("visibility","visible"),t(e).removeData("Jcrop")}function O(t,e){pt.release(),T();var i=new Image;i.onload=function(){var n=i.width,s=i.height,o=R.boxWidth,a=R.boxHeight;V.width(n).height(s),V.attr("src",t),q.attr("src",t),f(V,o,a),B=V.width(),$=V.height(),q.width(B).height($),rt.width(B+2*at).height($+2*at),Y.width(B).height($),dt.resize(B,$),E(),"function"==typeof e&&e.call(gt)},i.src=t}function I(t,e,i){var n=e||R.bgColor;R.bgFade&&o()&&R.fadeTime&&!i?t.animate({backgroundColor:n},{queue:!1,duration:R.fadeTime}):t.css("backgroundColor",n)}function P(t){R.allowResize?t?pt.enableOnly():pt.enableHandles():pt.disableHandles(),ft.setCursor(R.allowSelect?"crosshair":"default"),pt.setCursor(R.allowMove?"move":"default"),R.hasOwnProperty("trueSize")&&(et=R.trueSize[0]/B,it=R.trueSize[1]/$),R.hasOwnProperty("setSelect")&&(k(R.setSelect),pt.done(),delete R.setSelect),dt.refresh(),R.bgColor!=lt&&(I(R.shade?dt.getShades():Y,R.shade?R.shadeColor||R.bgColor:R.bgColor),lt=R.bgColor),ht!=R.bgOpacity&&(ht=R.bgOpacity,R.shade?dt.refresh():pt.setBgOpacity(ht)),Q=R.maxSize[0]||0,X=R.maxSize[1]||0,Z=R.minSize[0]||0,tt=R.minSize[1]||0,R.hasOwnProperty("outerImage")&&(V.attr("src",R.outerImage),delete R.outerImage),pt.refresh()}var A,R=t.extend({},t.Jcrop.defaults),j=navigator.userAgent.toLowerCase(),z=/msie/.test(j),F=/msie [1-6]\./.test(j);"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof i&&(i={}),l(i);var H={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},L=t(e),W=!0;if("IMG"==e.tagName){if(0!=L[0].width&&0!=L[0].height)L.width(L[0].width),L.height(L[0].height);else{var U=new Image;U.src=L[0].src,L.width(U.width),L.height(U.height)}var V=L.clone().removeAttr("id").css(H).show();V.width(L.width()),V.height(L.height()),L.after(V).hide()}else V=L.css(H).show(),W=!1,null===R.shade&&(R.shade=!0);f(V,R.boxWidth,R.boxHeight);var B=V.width(),$=V.height(),Y=t("<div />").width(B).height($).addClass(s("holder")).css({position:"relative",backgroundColor:R.bgColor}).insertAfter(L).append(V);R.addClass&&Y.addClass(R.addClass);var q=t("<div />"),J=t("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),K=t("<div />").width("100%").height("100%").css("zIndex",320),G=t("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var t=ct.getFixed();R.onDblClick.call(gt,t)}).insertBefore(V).append(J,K);W&&(q=t("<img />").attr("src",V.attr("src")).css(H).width(B).height($),J.append(q)),F&&G.css({overflowY:"hidden"});var Q,X,Z,tt,et,it,nt,st,ot,at=R.boundary,rt=_().width(B+2*at).height($+2*at).css({position:"absolute",top:n(-at),left:n(-at),zIndex:290}).mousedown(v),lt=R.bgColor,ht=R.bgOpacity;A=a(V);var ut=function(){function t(){var t,e={},i=["touchstart","touchmove","touchend"],n=document.createElement("div");try{for(t=0;t<i.length;t++){var s=i[t];s="on"+s;var o=s in n;o||(n.setAttribute(s,"return;"),o="function"==typeof n[s]),e[i[t]]=o}return e.touchstart&&e.touchend&&e.touchmove}catch(a){return!1}}function e(){return R.touchSupport===!0||R.touchSupport===!1?R.touchSupport:t()}return{createDragger:function(t){return function(e){return R.disabled?!1:"move"!==t||R.allowMove?(A=a(V),nt=!0,h(t,r(ut.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(t){return v(ut.cfilter(t))},cfilter:function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t},isSupported:t,support:e()}}(),ct=function(){function t(t){t=a(t),f=d=t[0],m=p=t[1]}function e(t){t=a(t),u=t[0]-f,c=t[1]-m,f=t[0],m=t[1]}function i(){return[u,c]}function n(t){var e=t[0],i=t[1];0>d+e&&(e-=e+d),0>p+i&&(i-=i+p),m+i>$&&(i+=$-(m+i)),f+e>B&&(e+=B-(f+e)),d+=e,f+=e,p+=i,m+=i}function s(t){var e=o();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function o(){if(!R.aspectRatio)return l();var t,e,i,n,s=R.aspectRatio,o=R.minSize[0]/et,a=R.maxSize[0]/et,u=R.maxSize[1]/it,c=f-d,g=m-p,v=Math.abs(c),y=Math.abs(g),_=v/y;return 0===a&&(a=10*B),0===u&&(u=10*$),s>_?(e=m,i=y*s,t=0>c?d-i:i+d,0>t?(t=0,n=Math.abs((t-d)/s),e=0>g?p-n:n+p):t>B&&(t=B,n=Math.abs((t-d)/s),e=0>g?p-n:n+p)):(t=f,n=v/s,e=0>g?p-n:p+n,0>e?(e=0,i=Math.abs((e-p)*s),t=0>c?d-i:i+d):e>$&&(e=$,i=Math.abs(e-p)*s,t=0>c?d-i:i+d)),t>d?(o>t-d?t=d+o:t-d>a&&(t=d+a),e=e>p?p+(t-d)/s:p-(t-d)/s):d>t&&(o>d-t?t=d-o:d-t>a&&(t=d-a),e=e>p?p+(d-t)/s:p-(d-t)/s),0>t?(d-=t,t=0):t>B&&(d-=t-B,t=B),0>e?(p-=e,e=0):e>$&&(p-=e-$,e=$),h(r(d,p,t,e))}function a(t){return t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t[0]>B&&(t[0]=B),t[1]>$&&(t[1]=$),[Math.round(t[0]),Math.round(t[1])]}function r(t,e,i,n){var s=t,o=i,a=e,r=n;return t>i&&(s=i,o=t),e>n&&(a=n,r=e),[s,a,o,r]}function l(){var t,e=f-d,i=m-p;return Q&&Math.abs(e)>Q&&(f=e>0?d+Q:d-Q),X&&Math.abs(i)>X&&(m=i>0?p+X:p-X),tt/it&&Math.abs(i)<tt/it&&(m=i>0?p+tt/it:p-tt/it),Z/et&&Math.abs(e)<Z/et&&(f=e>0?d+Z/et:d-Z/et),0>d&&(f-=d,d-=d),0>p&&(m-=p,p-=p),0>f&&(d-=f,f-=f),0>m&&(p-=m,m-=m),f>B&&(t=f-B,d-=t,f-=t),m>$&&(t=m-$,p-=t,m-=t),d>B&&(t=d-$,m-=t,p-=t),p>$&&(t=p-$,m-=t,p-=t),h(r(d,p,f,m))}function h(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var u,c,d=0,p=0,f=0,m=0;return{flipCoords:r,setPressed:t,setCurrent:e,getOffset:i,moveOffset:n,getCorner:s,getFixed:o}}(),dt=function(){function e(t,e){f.left.css({height:n(e)}),f.right.css({height:n(e)})}function i(){return s(ct.getFixed())}function s(t){f.top.css({left:n(t.x),width:n(t.w),height:n(t.y)}),f.bottom.css({top:n(t.y2),left:n(t.x),width:n(t.w),height:n($-t.y2)}),f.right.css({left:n(t.x2),width:n(B-t.x2)}),f.left.css({width:n(t.x)})}function o(){return t("<div />").css({position:"absolute",backgroundColor:R.shadeColor||R.bgColor}).appendTo(p)}function a(){d||(d=!0,p.insertBefore(V),i(),pt.setBgOpacity(1,0,1),q.hide(),r(R.shadeColor||R.bgColor,1),pt.isAwake()?h(R.bgOpacity,1):h(1,1))}function r(t,e){I(c(),t,e)}function l(){d&&(p.remove(),q.show(),d=!1,pt.isAwake()?pt.setBgOpacity(R.bgOpacity,1,1):(pt.setBgOpacity(1,1,1),pt.disableHandles()),I(Y,0,1))}function h(t,e){d&&(R.bgFade&&!e?p.animate({opacity:1-t},{queue:!1,duration:R.fadeTime}):p.css({opacity:1-t}))}function u(){R.shade?a():l(),pt.isAwake()&&h(R.bgOpacity)}function c(){return p.children()}var d=!1,p=t("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:o(),left:o().height($),right:o().height($),bottom:o()};return{update:i,updateRaw:s,getShades:c,setBgColor:r,enable:a,disable:l,resize:e,refresh:u,opacity:h}}(),pt=function(){function e(e){var i=t("<div />").css({position:"absolute",opacity:R.borderOpacity}).addClass(s(e));return J.append(i),i}function i(e,i){var n=t("<div />").mousedown(p(e)).css({cursor:e+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+e);return ut.support&&n.bind("touchstart.jcrop",ut.createDragger(e)),K.append(n),n}function o(t){var e=R.handleSize,n=i(t,T++).css({opacity:R.handleOpacity}).addClass(s("handle"));return e&&n.width(e).height(e),n}function a(t){return i(t,T++).addClass("jcrop-dragbar")}function r(t){var e;for(e=0;e<t.length;e++)N[t[e]]=a(t[e])}function l(t){var i,n;for(n=0;n<t.length;n++){switch(t[n]){case"n":i="hline";break;case"s":i="hline bottom";break;case"e":i="vline right";break;case"w":i="vline"}E[t[n]]=e(i)}}function h(t){var e;for(e=0;e<t.length;e++)M[t[e]]=o(t[e])}function u(t,e){R.shade||q.css({top:n(-e),left:n(-t)}),G.css({top:n(e),left:n(t)})}function c(t,e){G.width(Math.round(t)).height(Math.round(e))}function d(){var t=ct.getFixed();ct.setPressed([t.x,t.y]),ct.setCurrent([t.x2,t.y2]),f()}function f(t){return S?g(t):void 0}function g(t){var e=ct.getFixed();c(e.w,e.h),u(e.x,e.y),R.shade&&dt.updateRaw(e),S||y(),t?R.onSelect.call(gt,m(e)):R.onChange.call(gt,m(e))}function v(t,e,i){(S||e)&&(R.bgFade&&!i?V.animate({opacity:t},{queue:!1,duration:R.fadeTime}):V.css("opacity",t))}function y(){G.show(),R.shade?dt.opacity(ht):v(ht,!0),S=!0}function b(){D(),G.hide(),R.shade?dt.opacity(1):v(1),S=!1,R.onRelease.call(gt)}function w(){O&&K.show()}function k(){return O=!0,R.allowResize?(K.show(),!0):void 0}function D(){O=!1,K.hide()}function C(t){t?(st=!0,D()):(st=!1,k())}function x(){C(!1),d()}var S,T=370,E={},M={},N={},O=!1;R.dragEdges&&t.isArray(R.createDragbars)&&r(R.createDragbars),t.isArray(R.createHandles)&&h(R.createHandles),R.drawBorders&&t.isArray(R.createBorders)&&l(R.createBorders),t(document).bind("touchstart.jcrop-ios",function(e){t(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var I=_().mousedown(p("move")).css({cursor:"move",position:"absolute",zIndex:360});return ut.support&&I.bind("touchstart.jcrop",ut.createDragger("move")),J.append(I),D(),{updateVisible:f,update:g,release:b,refresh:d,isAwake:function(){return S},setCursor:function(t){I.css("cursor",t)},enableHandles:k,enableOnly:function(){O=!0},showHandles:w,disableHandles:D,animMode:C,setBgOpacity:v,done:x}}(),ft=function(){function e(e){rt.css({zIndex:450}),e?t(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",l):d&&t(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",s)}function i(){rt.css({zIndex:290}),t(document).unbind(".jcrop")}function n(t){return u(r(t)),!1}function s(t){return t.preventDefault(),t.stopPropagation(),nt&&(nt=!1,c(r(t)),pt.isAwake()&&R.onSelect.call(gt,m(ct.getFixed())),i(),u=function(){},c=function(){}),!1}function o(t,i,n){return nt=!0,u=t,c=i,e(n),!1}function a(t){return u(r(ut.cfilter(t))),!1}function l(t){return s(ut.cfilter(t))}function h(t){rt.css("cursor",t)}var u=function(){},c=function(){},d=R.trackDocument;return d||rt.mousemove(n).mouseup(s).mouseout(s),V.before(rt),{activateHandlers:o,setCursor:h}}(),mt=function(){function e(){R.keySupport&&(o.show(),o.focus())}function i(){o.hide()}function n(t,e,i){R.allowMove&&(ct.moveOffset([e,i]),pt.updateVisible(!0)),t.preventDefault(),t.stopPropagation()}function s(t){if(t.ctrlKey||t.metaKey)return!0;ot=!!t.shiftKey;var e=ot?10:1;switch(t.keyCode){case 37:n(t,-e,0);break;case 39:n(t,e,0);break;case 38:n(t,0,-e);break;case 40:n(t,0,e);break;case 27:R.allowSelect&&pt.release();break;case 9:return!0}return!1}var o=t('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=t("<div />").css({position:"absolute",overflow:"hidden"}).append(o);return R.keySupport&&(o.keydown(s).blur(i),F||!R.fixedSupport?(o.css({position:"absolute",left:"-20px"}),a.append(o).insertBefore(V)):o.insertBefore(V)),{watchKeys:e}}();ut.support&&rt.bind("touchstart.jcrop",ut.newSelection),K.hide(),P(!0);var gt={setImage:O,animateTo:w,setSelect:k,setOptions:S,tellSelect:C,tellScaled:x,setClass:b,disable:T,enable:E,cancel:M,release:pt.release,destroy:N,focus:mt.watchKeys,getBounds:function(){return[B*et,$*it]},getWidgetSize:function(){return[B,$]},getScaleFactor:function(){return[et,it]},getOptions:function(){return R},ui:{holder:Y,selection:G}};return z&&Y.bind("selectstart",function(){return!1}),L.data("Jcrop",gt),gt},t.fn.Jcrop=function(e,i){var n;return this.each(function(){if(t(this).data("Jcrop")){if("api"===e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?t.Jcrop.Loader(this,function(){t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n)}):(t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n))}),this},t.Jcrop.Loader=function(e,i,n){function s(){a.complete?(o.unbind(".jcloader"),t.isFunction(i)&&i.call(a)):window.setTimeout(s,50)}var o=t(e),a=o[0];o.bind("load.jcloader",s).bind("error.jcloader",function(){o.unbind(".jcloader"),t.isFunction(n)&&n.call(a)}),a.complete&&t.isFunction(i)&&(o.unbind(".jcloader"),i.call(a))},t.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);