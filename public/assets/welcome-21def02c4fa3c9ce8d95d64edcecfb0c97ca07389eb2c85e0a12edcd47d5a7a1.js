$(function(){function t(t){for(var e=c.getElementsByTagName("div"),i=0;i<e.length;i++)e[i].className=e[i].className.replace(/active/,"").replace(/\s\s*$/,"");t.className+=" active"}function e(){p.eachLayer(function(e){var i=e.feature.properties,o=c.appendChild(document.createElement("div"));o.className="item";var n=o.appendChild(document.createElement("a"));n.href="#",n.className="title",n.id="person",n.innerHTML=i.name;var a=o.appendChild(document.createElement("div"));a.innerHTML=i.location,n.onclick=function(){return t(o),s.setView(e.getLatLng(),16),e.openPopup(),!1},e.on("click",function(i){s.panTo(e.getLatLng()),t(o)})})}L.mapbox.accessToken="pk.eyJ1IjoiYW1waGl0aGVyZSIsImEiOiIyZGE2MWJhYTdlNjJkM2E4NTZhYjUyODE3NDFmNzY3MSJ9.EDkcexR3h8zGfuPOXADctQ";var i=L.latLng(-180,-180),o=L.latLng(180,180),n=L.latLngBounds(i,o),s=L.mapbox.map("map","amphithere.nanckefd",{maxBounds:n,maxZoom:20,minZoom:2,tileLayer:{continuousWorld:!1,noWrap:!0}}).addControl(L.mapbox.geocoderControl("mapbox.places",{autocomplete:!0})),a=document.getElementById("filter-donor"),r=document.getElementById("filter-all"),l=document.getElementById("backToSize");s.fitBounds(n),l.onclick=function(){return s.setView([25,5],2),!1},a.onclick=function(t){return r.className="",this.className="active",c.innerHTML="",p.setFilter(function(t){return t.properties.donor===!0}),e(),!1},r.onclick=function(){return a.className="",this.className="active",c.innerHTML="",p.setFilter(function(t){return!0}),e(),!1},s.scrollWheelZoom.disable();var c=document.getElementById("listings"),p=L.mapbox.featureLayer().addTo(s);p.loadURL("welcome/map.json"),p.on("ready",function(){e()}),p.on("layeradd",function(t){var e=t.layer,i=(e.feature,e.feature.properties),o='<div class="popup"><h3>'+i.name+"</h3><b>"+i.title+"</b></p>"+i.bio+"</p></p><a href= /people/"+i.id+">Read more...</a></div>";o+="</div>",e.bindPopup(o,{minWidth:320})})}),$(function(){return $("form").on("click",".remove_fields",function(t){return $(this).closest(".field").remove(),t.preventDefault()}),$("form").on("click",".add_fields",function(t){var e,i;return i=(new Date).getTime(),e=new RegExp($(this).data("id"),"g"),$(this).before($(this).data("fields").replace(e,i)),t.preventDefault()})});