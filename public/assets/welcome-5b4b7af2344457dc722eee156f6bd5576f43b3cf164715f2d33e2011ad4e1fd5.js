$(function(){function e(e){for(var n=s.getElementsByTagName("div"),t=0;t<n.length;t++)n[t].className=n[t].className.replace(/active/,"").replace(/\s\s*$/,"");e.className+=" active"}function n(){d.eachLayer(function(n){var t=n.feature.properties,a=s.appendChild(document.createElement("div"));a.className="item";var o=a.appendChild(document.createElement("a"));o.href="#",o.title="Click to see this anthropologist!",o.className="title",o.id="person",o.innerHTML=t.name;var r=a.appendChild(document.createElement("div"));r.className="personTitle",r.innerHTML=t.researcher;var c=a.appendChild(document.createElement("div"));c.innerHTML=t.location,o.onclick=function(){return e(a),i.setView(n.getLatLng(),16),n.openPopup(),!1},n.on("click",function(){i.panTo(n.getLatLng()),e(a)})})}L.mapbox.accessToken="pk.eyJ1IjoiYW1waGl0aGVyZSIsImEiOiIyZGE2MWJhYTdlNjJkM2E4NTZhYjUyODE3NDFmNzY3MSJ9.EDkcexR3h8zGfuPOXADctQ";var t=L.latLng(-180,-180),a=L.latLng(180,180),o=L.latLngBounds(t,a),i=L.mapbox.map("map","amphithere.nanckefd",{maxBounds:o,maxZoom:20,minZoom:2,tileLayer:{continuousWorld:!1,noWrap:!0}}).addControl(L.mapbox.geocoderControl("mapbox.places",{autocomplete:!0})),r=document.getElementById("filter-donor"),c=document.getElementById("filter-all"),l=document.getElementById("backToSize");i.fitBounds(o),l.onclick=function(){return i.setView([25,5],2),!1},r.onclick=function(){return c.className="",this.className="active",s.innerHTML="",d.setFilter(function(e){return e.properties.available===!0}),n(),!1},c.onclick=function(){return r.className="",this.className="active",s.innerHTML="",d.setFilter(function(){return!0}),n(),!1},i.scrollWheelZoom.disable();var s=document.getElementById("listings"),d=L.mapbox.featureLayer().addTo(i);d.loadURL("welcome/map.json"),d.on("ready",function(){n()}),d.on("layeradd",function(e){var n=e.layer,t=(n.feature,n.feature.properties),a='<div class="popup"><h3>'+t.name+"</h3><b>"+t.researcher+'</b><p><div class = "line-clamp">'+t.bio+"</div></p><a href= /researches/"+t.id+">Read more...</a>";a+="</div>",n.bindPopup(a,{minWidth:320})})}),$(function(){$("#backToSize").tooltip()});